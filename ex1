from docx import Document
from PyPDF2 import PdfWriter
from io import BytesIO
from reportlab.lib.pagesizes import letter
from reportlab.platypus import SimpleDocTemplate, Paragraph
from reportlab.lib.styles import getSampleStyleSheet

def extract_pages_with_changes(docx_file):
    document = Document(docx_file)
    pages_with_changes = []

    for i, paragraph in enumerate(document.paragraphs):
        if any(run.revision for run in paragraph.runs):
            pages_with_changes.append(i + 1)

    return pages_with_changes

def create_pdf_with_changes(docx_file, output_pdf):
    pages_with_changes = extract_pages_with_changes(docx_file)

    pdf_writer = PdfWriter()

    buffer = BytesIO()
    doc = SimpleDocTemplate(buffer, pagesize=letter)
    styles = getSampleStyleSheet()
    elements = []

    document = Document(docx_file)
    for page_num in pages_with_changes:
        for i, paragraph in enumerate(document.paragraphs):
            if i == page_num - 1:
                text = paragraph.text
                p = Paragraph(text, styles["Normal"])
                elements.append(p)
    
    doc.build(elements)
    pdf_writer.append(buffer)

    with open(output_pdf, 'wb') as output:
        pdf_writer.write(output)

docx_file = "your_docx_file.docx"
output_pdf = "output_with_changes.pdf"

create_pdf_with_changes(docx_file, output_pdf)
