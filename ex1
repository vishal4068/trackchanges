import os
import docx
import zipfile
from lxml import etree

def add_track_changes_mode(docx_file_path):
    # Load the Word document settings
    zfile = zipfile.ZipFile(docx_file_path)
    xmlcontent = zfile.read('word/settings.xml')
    stgs_xml = etree.fromstring(xmlcontent)

    # Create the XML element for track changes
    xml_to_insert = etree.fromstring('<w:trackRevisions xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main"/>')

    # Insert the new XML into the settings
    for node in stgs_xml.xpath('//w:settings', namespaces={'w': 'http://schemas.openxmlformats.org/wordprocessingml/2006/main'}):
        node.insert(2, xml_to_insert)

    # Convert the modified settings back to a string
    stgs_new = etree.tostring(stgs_xml)

    # Update the Word document with the modified settings
    with open(docx_file_path, 'rb') as original_doc:
        original_content = original_doc.read()
        modified_content = original_content.replace(xmlcontent, stgs_new)

    # Save the modified content back to the DOCX file
    with open(docx_file_path, 'wb') as modified_doc:
        modified_doc.write(modified_content)

if __name__ == "__main__":
    input_docx_path = "path/to/your/input.docx"
    add_track_changes_mode(input_docx_path)
    print(f"Track changes mode enabled in {input_docx_path}")
