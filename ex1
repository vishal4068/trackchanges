from docx import Document
from docx.shared import Inches
from PyPDF2 import PdfFileReader, PdfFileWriter

def convert_docx_to_pdf_with_track_changes(docx_file, pdf_file):
    document = Document(docx_file)
    # Show track changes
    for paragraph in document.paragraphs:
        for run in paragraph.runs:
            run.font.color.rgb = None  # Reset font color to default
            run.font.strike = None      # Remove strike-through
            if run.element.rPr.rStyle and run.element.rPr.rStyle.val == 'BalloonText':
                run.font.color.rgb = 'FF0000'  # Set font color to red
                run.font.strike = True          # Apply strike-through
    
    document.save(pdf_file)

def extract_pages_with_track_changes(pdf_file, output_pdf):
    writer = PdfFileWriter()
    with open(pdf_file, 'rb') as infile:
        reader = PdfFileReader(infile)
        for page_num in range(reader.numPages):
            page = reader.getPage(page_num)
            # Check if page has any changes (e.g., red text)
            if "/ColorSpace /DeviceCMYK" in str(page):
                writer.addPage(page)
    
    with open(output_pdf, 'wb') as outfile:
        writer.write(outfile)

if __name__ == "__main__":
    docx_file = "your_docx_file.docx"
    pdf_with_track_changes = "doc_with_track_changes.pdf"
    convert_docx_to_pdf_with_track_changes(docx_file, pdf_with_track_changes)

    output_pdf = "track_changes_pages.pdf"
    extract_pages_with_track_changes(pdf_with_track_changes, output_pdf)
